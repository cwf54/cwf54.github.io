---
layout: post
title: "Lab 3"
subtitle: "Time of Flight Sensors"
date: 2023-02-15 23:45:13 -0400
background: '/img/posts/no.jpg'
---

<h2 class="section-heading">Pre-Lab</h2>
<p>Time of Flight sensors are used to detect how far something is, such as a wall. The final robot will use two of these sensors. </p>
<img class="img-fluid" src="/img/lab3pics/sensor.jpg" alt="..." /> 


<p>With two sensors, it is worthwhile to consider where on the robot's body the sensors will be placed. Ideally, there would be more than two sensors so that obstacles could be detected from all sorts of directions, but we will make do with the two we have.</p>
<p>It is natural to put one sensor at the front of the robot so that it does not hit walls head on. After that, I will put the other sensor on the right side of the robot. </p>
<img class="img-fluid" src="/img/lab3pics/TOFbody.jpg" alt="..." /> 
<p>This side sensor will help detect when to take a turn. If it is at a corner where both the right and front sensors are detecting a close wall, it should take a left turn. If it was just in a region where the right wall was close and now it is far, maybe it should take a right turn. There would be better mobility with a TOF sensor on the left side, but when the sensors are actually on the robot I can play around more with their placements.</p>

<p>The sensors communicate with the Artemis via I2C. To wire this system, I used a QWIIC breakout board from Sparkfun, and soldered the ends of the QWIIC cables to the TOF sensors. I also connected the XSHUT pin of one of the TOF sensors to a GPIO pin on the Artemis so that data can be read from both, which will be discussed more later in this write-up. </p>
<img class="img-fluid" src="/img/lab3pics/TOFcircuit.jpg" alt="..." /> 
<p>Here is what the actual circuit looks like:</p>
<!-- hardware pic -->
<img class="img-fluid" src="/img/lab3pics/TOFhardware.jpg" alt="..." /> 

<h2 class="section-heading">Using One Sensor: Sensor Address</h2>
<p>Before jumping straight to getting data from both TOF sensors simultaneously, I started out by checking the address of the device with the Wire_I2C example program in the Apollo3 library. </p>
<img class="img-fluid" src="/img/lab3pics/TOFaddress.jpg" alt="..." /> 
<p>The address is 0x29. This address is how the Artemis will identify which device it is exchanging data with on the I2C SDA line.</p>

<h2 class="section-heading">Reading data from the Sensor</h2>

<p>Now to read distance data from the sensor, I ran the Read Distance example program from the SparkFun VL53L1X 4m Laser Distance Sensor Library. This program prints the distance data.</p>
<p>There are two modes to choose from: Short (max range is 1.3m) or Long (max range is 4m). For the purposes of this class, I chose the short distance mode. 4 meters is a long distance, especially to our relatively small robots (the sides are less than a foot long). Also, for the sake of not running into things, I want the robots to be able to accurately detect obstacles that are closer than 2 feet away.</p>
<p>The Long Distance mode is the default mode, so in the setup of the Arduino program, I called the function .setDistanceModeShort().</p>
<p>To test the sensor's accuracy, I collected several of it's readings at known distances. </p>
<img class="img-fluid" src="/img/lab3pics/distancetest.jpg" alt="..." /> 

<img class="img-fluid" src="/img/lab3pics/distancegraph.png" alt="..." /> 
<p>The sensor was very accurate up to about 2 feet away. Then it began underestimating increasingly. At 3.5 feet away, it read 3.14 feet away. This is manageable, and when using the sensors on the robot in the future, I will be cautious and take these underestimations into account. </p>

<h2 class="section-heading">Two Sensors in Parallel</h2>

<p>The two TOF sensors have the same address. For the Artemis to be able to communicate with both chips in parallel, either the sensors need to alternate turning on and off during each read, or one of them needs a different address.</p>
<p>Basing my approach on Anya Probawo's Write Up from last year, I decided to change the address of one of the sensors. I soldered a wire from the XSHUT pin of one of the sensors to GPIO pin 8 on the Artemis. This wire allows me to shut down one of the sensors. During this shutdown in the setup of the Arduino program, I set the address of one of the sensors to 0x32.</p>
<img class="img-fluid" src="/img/lab3pics/TOFshutdiwn.jpg" alt="..." /> 
<p>Now the Artemis can communicate with both sensors without any mixup. Here are the readings from the sensors. </p>
<img class="img-fluid" src="/img/lab3pics/sensordata.jpg" alt="..." /> 

<h2 class="section-heading">Timing of Data Reading</h2>
<p>Now we are interested in how long these sensor readings take. I read the time using millis() before the data was taken and again right after it was taken.</p>
<img class="img-fluid" src="/img/lab3pics/timing code.jpg" alt="..." /> 
<img class="img-fluid" src="/img/lab3pics/timing.jpg" alt="..." /> 
<p>It can be seen that each reading takes 57 milliseconds. The bulk of this delay is from the sensor itself collecting data. If less data was collected, the delay would be shorter, but the results would be less accurate.</p>

<h2 class="section-heading">Time Vs. Distance</h2>
<p>With the sensors working, we can send their data to my laptop via Bluetooth using the command protocol from lab 2. I started out by creating a GET_TOF command.</p>
<script src="https://gist.github.com/cwf54/60cf288c02317b8474ceb1059a18717f.js"></script>
<p>The current time and two distance data points are send to my laptop in the form of "T:(time)|D1:(distance1)|D2:(distance2) </p>
<p>Then I modified the notification handler to read the individual data points and append them to their respective arrays.</p>
<img class="img-fluid" src="/img/lab3pics/handler.jpg" alt="..." /> 
<p>With the arrays set up, I plotted them using MatPlotLib</p>
<img class="img-fluid" src="/img/lab3pics/plot.jpg" alt="..." /> 
<img class="img-fluid" src="/img/lab3pics/finalgraph.jpg" alt="..." /> 

<p></p>
<p></p>
<p></p>



<p></p>
<p></p>
<p></p>
<p></p>


<h2 class="section-heading"></h2>

<!-- <span class="caption text-muted">To go places and do things that have never been done before – that’s what living is all about.</span> -->

<p>Placeholder text by <a href="http://spaceipsum.com/">Space Ipsum</a>. Photographs by <a href="https://unsplash.com/">Unsplash</a>.</p>
